# Streamlit å†…å­˜ä¼˜åŒ–æ–¹æ¡ˆ

## å·²å®æ–½çš„ä¼˜åŒ–æªæ–½

### 1. æ•°æ®ç¼“å­˜ä¼˜åŒ–
- **é—®é¢˜**: é»˜è®¤çš„ `@st.cache_data` ä¼šä¸ºæ¯ä¸ªç”¨æˆ·ä¼šè¯ç¼“å­˜æ•°æ®
- **è§£å†³**: æ·»åŠ  `ttl=3600` (1å°æ—¶è¿‡æœŸ) å’Œ `max_entries=1` (æœ€å¤šç¼“å­˜1ä»½)
```python
@st.cache_data(ttl=3600, max_entries=1)
def load_data():
    ...
```

### 2. Session State æ•°æ®å‹ç¼©
- **é—®é¢˜**: å­˜å‚¨å®Œæ•´çš„éªŒè¯é›†å’Œæ¨¡å‹æ•°æ®å ç”¨å¤§é‡å†…å­˜
- **è§£å†³**: 
  - å°† numpy æ•°ç»„è½¬æ¢ä¸º Python åˆ—è¡¨ï¼ˆæ›´èŠ‚çœå†…å­˜ï¼‰
  - åˆ é™¤ä¸å¿…è¦çš„ä¸­é—´æ•°æ®ï¼ˆå¦‚ `X_val`ï¼‰
  - åªä¿å­˜å¿…è¦çš„é¢„æµ‹ç»“æœ

### 3. Matplotlib å†…å­˜ç®¡ç†
- **é—®é¢˜**: å›¾è¡¨å¯¹è±¡ä¸é‡Šæ”¾å¯¼è‡´å†…å­˜ç´¯ç§¯
- **è§£å†³**:
  - ä½¿ç”¨ `plt.switch_backend('Agg')` éäº¤äº’å¼åç«¯
  - æ¯æ¬¡ç»˜å›¾åæ˜¾å¼ `plt.close(fig)` å’Œ `del fig, ax`
  - æ·»åŠ  `cleanup_memory()` å‡½æ•°å®šæœŸæ¸…ç†

### 4. é™åˆ¶å¹¶è¡Œè®¡ç®—
- **é—®é¢˜**: scikit-learn çš„ `n_jobs=-1` ä¼šåˆ›å»ºè¿‡å¤šçº¿ç¨‹
- **è§£å†³**:
  - RandomForest æ”¹ç”¨ `n_jobs=2`
  - æ·»åŠ ç¯å¢ƒå˜é‡é™åˆ¶çº¿ç¨‹æ•°
  - ä½¿ç”¨ `max_samples=0.8` é™åˆ¶æ¯æ£µæ ‘çš„æ ·æœ¬æ•°

### 5. é…ç½®æ–‡ä»¶ä¼˜åŒ–
åˆ›å»º `.streamlit/config.toml`:
- ç¦ç”¨ä¸å¿…è¦çš„åŠŸèƒ½ï¼ˆCORSã€é­”æ³•å‘½ä»¤ç­‰ï¼‰
- è°ƒæ•´æ—¥å¿—çº§åˆ«ä¸º warning
- é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°

## é¢å¤–å»ºè®®

### æ–¹æ¡ˆA: æ•°æ®é‡‡æ ·ï¼ˆæ¨èç”¨äºæ¼”ç¤ºï¼‰
å¦‚æœæ˜¯æ•™å­¦å¹³å°ï¼Œå¯ä»¥åªä½¿ç”¨éƒ¨åˆ†æ•°æ®è¿›è¡Œè®­ç»ƒï¼š

```python
@st.cache_data(ttl=3600, max_entries=1)
def load_data():
    df = pd.read_csv("splits/train.csv")
    # åªä½¿ç”¨30%çš„æ•°æ®ç”¨äºæ¼”ç¤º
    if len(df) > 5000:
        df = df.sample(n=5000, random_state=42)
    return df
```

### æ–¹æ¡ˆB: å»¶è¿ŸåŠ è½½
ä¸åœ¨é¡µé¢åŠ è½½æ—¶å°±åŠ è½½æ‰€æœ‰æ•°æ®ï¼š

```python
# åªåœ¨ç”¨æˆ·ç‚¹å‡»è®­ç»ƒæŒ‰é’®æ—¶æ‰åŠ è½½æ•°æ®
if st.button("ğŸš€ å¼€å§‹è®­ç»ƒæ¨¡å‹"):
    df = load_data()  # åœ¨è¿™é‡ŒåŠ è½½
    ...
```

### æ–¹æ¡ˆC: ä½¿ç”¨è½»é‡çº§æ¨¡å‹
é»˜è®¤ä½¿ç”¨æ›´è½»é‡çš„æ¨¡å‹å‚æ•°ï¼š

```python
# å‡å°‘éšæœºæ£®æ—çš„æ ‘æ•°é‡
n_estimators = 50  # è€Œä¸æ˜¯ 200

# é™åˆ¶æ ‘çš„æ·±åº¦
max_depth = 10  # è€Œä¸æ˜¯ None
```

### æ–¹æ¡ˆD: åˆ†é¡µæ˜¾ç¤º
å¯¹äºå¤§å‹ç›¸å…³æ€§çŸ©é˜µï¼Œå¯ä»¥åˆ†æ‰¹æ˜¾ç¤ºç‰¹å¾ï¼š

```python
# è®©ç”¨æˆ·é€‰æ‹©è¦æŸ¥çœ‹çš„ç‰¹å¾ç»„
feature_group = st.selectbox(
    "é€‰æ‹©ç‰¹å¾ç»„",
    ["åŸºæœ¬ä¿¡æ¯", "åˆå¹¶ç—‡", "è¯ç‰©ç‰¹å¾"]
)
# åªæ˜¾ç¤ºé€‰ä¸­ç»„çš„ç›¸å…³æ€§
```

## Streamlit Cloud ç‰¹å®šä¼˜åŒ–

### 1. æ·»åŠ  `.streamlit/config.toml`
å·²åˆ›å»ºï¼ŒåŒ…å«å†…å­˜ä¼˜åŒ–é…ç½®ã€‚

### 2. åœ¨ requirements.txt ä¸­å›ºå®šç‰ˆæœ¬
é¿å…å®‰è£…ä¸å¿…è¦çš„ä¾èµ–ï¼š

```txt
streamlit==1.28.0
pandas==2.0.3
numpy==1.24.3
scikit-learn==1.3.0
matplotlib==3.7.2
seaborn==0.12.2
```

### 3. ç›‘æ§å†…å­˜ä½¿ç”¨
åœ¨ Streamlit Cloud çš„ "Manage app" é¡µé¢å¯ä»¥çœ‹åˆ°å†…å­˜ä½¿ç”¨æƒ…å†µã€‚

### 4. å‡çº§åˆ°ä»˜è´¹ç‰ˆ
å¦‚æœå…è´¹ç‰ˆçš„ 1GB å†…å­˜ä¸å¤Ÿï¼š
- Streamlit Community Cloud ä»˜è´¹ç‰ˆæä¾›æ›´å¤šå†…å­˜
- æˆ–è€…éƒ¨ç½²åˆ°å…¶ä»–å¹³å°ï¼ˆHeroku, Railway, AWS ç­‰ï¼‰

## è¯Šæ–­å‘½ä»¤

å¦‚æœæƒ³è¦æŸ¥çœ‹å“ªé‡Œå ç”¨å†…å­˜æœ€å¤šï¼Œå¯ä»¥ä¸´æ—¶æ·»åŠ ï¼š

```python
import sys

# æŸ¥çœ‹å¯¹è±¡å¤§å°
def get_size(obj):
    size = sys.getsizeof(obj)
    if isinstance(obj, dict):
        size += sum([get_size(v) for v in obj.values()])
        size += sum([get_size(k) for k in obj.keys()])
    elif isinstance(obj, (list, tuple)):
        size += sum([get_size(i) for i in obj])
    return size

# åœ¨å…³é”®ä½ç½®æ‰“å°å†…å­˜ä½¿ç”¨
st.write(f"Session state size: {get_size(st.session_state) / 1024 / 1024:.2f} MB")
```

## é¢„æœŸæ•ˆæœ

è¿™äº›ä¼˜åŒ–æªæ–½åº”è¯¥å¯ä»¥å°†å†…å­˜å ç”¨å‡å°‘ **30-50%**ï¼š

- **åŸæ¥**: ~800MB+ (å¤šç”¨æˆ·åŒæ—¶ä½¿ç”¨æ—¶)
- **ä¼˜åŒ–å**: ~400-500MB

å¦‚æœè¿˜æ˜¯ä¸å¤Ÿï¼Œå»ºè®®é‡‡ç”¨"æ–¹æ¡ˆA"ï¼ˆæ•°æ®é‡‡æ ·ï¼‰æˆ–å‡çº§åˆ°ä»˜è´¹ç‰ˆã€‚
